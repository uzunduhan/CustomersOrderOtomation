@using System.Text.Json;
@using CustomersOrderOtomation.Dto.Dtos;
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@model List<CustomersOrderOtomation.ViewModel.ShopList.ShopListViewModel>


<table class="table align-middle mb-0 bg-white">
    <thead class="bg-light">
        <tr>
            <th>Müşteri Bilgisi</th>
            <th>Masa Numarası</th>
            <th>Sipariş Bilgileri</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model)
        {
            var shopListData = JsonSerializer.Deserialize<List<ShopListAddShoppingCardProductsDto>>(item.ShopListProductsData);

            float topTotalPrice = 0;

            <tr>
                <td>
                    <p class="fw-normal mb-1">@item.OrderCustomerName</p>
                </td>
                <td>
                    <p class="fw-normal mb-1">@item.OrderTableNumber</p>
                </td>
                <td>
                    @foreach (var product in shopListData)
                    {
                        var totalPrice = @product.Piece * @product.Price;

                        @topTotalPrice += @totalPrice;

                        <span class="badge badge-success rounded-pill d-inline">@product.Piece @product.ProductName=@totalPrice TL</span>

                    }

                    <span class="badge badge-primary rounded-pill d-inline">Total: @topTotalPrice TL</span>
                </td>
                <td>
                    <button type="button" class="btn btn-link btn-sm btn-rounded">
                        Edit
                    </button>
                </td>
            </tr>
        }

    </tbody>
</table>